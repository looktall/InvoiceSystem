<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>Invoice System</title>
    <style>
        body {
            padding-top: 56px; /* Adjust the top padding to match the height of the fixed navbar */
        }

        .side-panel {
            position: fixed;
            top: 56px;
            left: 0;
            width: 15%;
            height: 100%;
            background-color: #98c1ff;
            padding-top: 10px;
        }

        .side-panel a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 18px;
            color: #000000;
            display: block;
        }

        .side-panel a:hover {
            background-color: #49c5ff;
        }

        .center-box {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            height: 100vh; /* 100% of the viewport height */
            margin-left: 15%; /* Adjusted to match the width of the side panel */
            max-width: 85%;
        }

        .center-content {
            width: 100%; /* Ensure content takes full width */
        }
    </style>
</head>

<body>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="#">Logo</a>
        <!-- Add a button to toggle the side panel -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <!-- Display username and logout link -->
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <span class="navbar-text">
                        Welcome, <strong><span id="username"></span></strong>
                    </span>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Logout</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Side Panel -->
    <div class="side-panel">
        <ul class="nav nav-pills nav flex-column">
            <li class="nav-item">
                <a id="nav-overview" class="nav-link active" aria-current="page" href="#" onclick="showOverview()">Overview</a>
            </li>
            <li class="nav-item">
                <a id="nav-vendor" class="nav-link" href="#" onclick="showVendor()">Vendor</a>
            </li>
            <li class="nav-item">
                <a id="nav-invoice" class="nav-link" href="#" onclick="showInvoice()">Invoice</a>
            </li>
            <li class="nav-item">
                <a id="nav-setting" class="nav-link" href="#" tabindex="-1" aria-disabled="true">Setting</a>
            </li>
        </ul>
    </div>

     <!-- Modal -->
    <div id="vendor-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <p id="vendor-modal-message"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="hideModal()">Discard</button>
                    <button type="button" class="btn btn-success" onclick="">Create</button>
                </div>
          </div>
        </div>
    </div>

    <div id="invoice-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <p id="invoice-modal-message"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="hideModal()">Discard</button>
                    <button type="button" class="btn btn-success" onclick="">Create</button>
                </div>
          </div>
        </div>
    </div>

    <!-- Centered Content Box -->
    <div id="mainContent" class="container-fluid center-box">
        <div class="center-content">
            <!-- JavaScript will populate content here -->
        </div>
    </div>

    <script>
        const token = localStorage.getItem('token');

        const vendorModal = document.getElementById('vendor-modal');
        const vendorModalMessage = document.getElementById('vendor-modal-message');

        const invoiceModal = document.getElementById('invoice-modal');
        const invoiceModalMessage = document.getElementById('invoice-modal-message');

        if (token)
        {
            var decoded_token = jwt_decode(token);
            document.getElementById("username").innerHTML = decoded_token.username;

            if (decoded_token.exp < Math.floor(Date.now()/1000))
            {
                window.stop();
                localStorage.removeItem("token");
                window.location.href = 'login.html';
            }
        }

        function updateNavBar(id)
        {
            getElementById("nav-overview").classList.remove("active");
            getElementById("nav-vendor").classList.remove("active");
            getElementById("nav-invoice").classList.remove("active");
            getElementById("nav-setting").classList.remove("active");

            getElementById(id).classList.remove("active");
        }

        function showVendorModal() {

            updateNavBar("nav-vendor");

            var content = '<table class="table table-sm table-borderless">';
            content += '<tr><td>Vendor Name : </td><td><input id="vendorName" required class="form-control" type="text" onchange="CheckNull()"/></td></tr>';
            content += '<tr><td>Company Name : </td><td><input id="companyName" required class="form-control" type="text" onchange="CheckNull()"/></td></tr>';
            content += '<tr><td>Address : </td><td><textarea id="address" class="form-control" style="height:150px"></textarea></td></tr>';
            content += '<tr><td>Email : </td><td><input id="email" required class="form-control" type="text" onchange="CheckNull()"/></td></tr>';
            content += '<tr><td>Contact No : </td><td><input id="contactNo" required class="form-control" type="text" onchange="CheckNull()"/></td></tr>';
            content += '</table>';

            vendorModalMessage.innerHTML = content;
            vendorModal.style.display = 'block';
        }

        function showInvoiceModal() {

            updateNavBar("nav-invoice");

            var content = '<table class="table table-sm table-borderless">';
            // Recipient
            content += '<tr><td>Recipient : </td><td><input id="recipient" required class="form-control" type="text" onchange="CheckNull()"/></td></tr>';
            // Item List
            content += '<tr><td>Item List : </td><td>';
            content += '<table class="item-table" id="itemTable">';
            content += '<tr><th>Item</th><th>Quantity</th><th>Unit Price</th><th>Action</th></tr>';
            content += '<tr>';
            content += '<td><input class="form-control" type="text" name="item[]" /></td>';
            content += '<td><input class="form-control" type="number" name="quantity[]" /></td>';
            content += '<td><input class="form-control" type="number" name="unitPrice[]" /></td>';
            content += '<td><button type="button" onclick="addRow()">Add</button></td>';
            content += '</tr>';
            content += '</table>';
            content += '</td></tr>';
            // Total
            content += '<tr><td>Total : </td><td><input id="total" readonly class="form-control" type="text"/></td></tr>';
            content += '</table>';

            invoiceModalMessage.innerHTML = content;
            invoiceModal.style.display = 'block';
        }

        function hideModal() {
            vendorModal.style.display = 'none';
            invoiceModal.style.display = 'none';
        }

        function showOverview() {

            updateNavBar("nav-overview");

            const mainContent = document.querySelector('.center-content');

            var data = `
                <table class="table table-sm table-borderless">
                <tr>
                    <td><canvas id="barChart" style="width:100%;></canvas></td>
                    <td><canvas id="pieChart" style="width:100%;></canvas></td>
                </tr>
                </table>
            `

            mainContent.innerHTML = data;
            
            new Chart("barChart", {
                type: 'bar',
                data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgb(255, 51, 51)',
                        'rgb(0, 128, 255)',
                        'rgb(255, 225, 51)',
                        'rgb(102, 204, 0)',
                        'rgb(102, 0, 204)',
                        'rgb(255, 128, 0)',
                    ],
                    borderWidth: 1
                }]
                },
                options: {
                scales: {
                    y: {
                    beginAtZero: true
                    }
                }
                }
            });

            new Chart("pieChart", {
                type: 'pie',
                data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgb(255, 51, 51)',
                        'rgb(0, 128, 255)',
                        'rgb(255, 225, 51)',
                        'rgb(102, 204, 0)',
                        'rgb(102, 0, 204)',
                        'rgb(255, 128, 0)',
                    ],
                    hoverOffset: 4,
                    borderWidth: 1
                }]
                },
                options: {
                scales: {
                    y: {
                    beginAtZero: true
                    }
                }
                }
            });
        }

        function showVendor() {

            updateNavBar("nav-vendor");

            const mainContent = document.querySelector('.center-content');
            
            var data = "";

            axios.get("https://invoice-system-api.onrender.com/vendor/get/",
            {headers: { authorization: `Bearer ${token}` }})
            .then(response => {

                data += `<div class="row">`;
                data += `<div class="col">`;
                data += `<table class="table table-hover table-sm">`;
                data += `<thead>`;
                data += `<tr>`;
                data += `<th><input type="text" class="form-control" placeholder="ID"></th>`;
                data += `<th><input type="text" class="form-control" placeholder="Name"></th>`;
                data += `<th><input type="text" class="form-control" placeholder="Amount"></th>`;
                data += `<th><button type="button" class="btn btn-success">Create</i></button></th>`;
                data += `</tr>`;

                data += `<tr>`;
                data += `<th>ID</th>`;
                data += `<th>Name</th>`;
                data += `<th>Amount</th>`;
                data += `<th>Action</th>`;
                data += `</tr>`;
                data += `</thead>`;
                data += `<tbody>`;
                

                for(i = 0; i < response.data; i++)
                {
                    data += `
                        <tr>
                            <td>1</td>
                            <td>Vendor 1</td>
                            <td>$100.00</td>
                            <td><button type="button" class="btn btn-success"><i class="fa-solid fa-pen-to-square"></i></button> <button type="button" class="btn btn-danger"><i class="fa-solid fa-trash"></i></button></td>
                        </tr>
                    `
                }

                data += `</tbody>`;
                data += `</table>`;
                data += `</div>`;
                data += `</div>`;
                data += `<div class="row">`;
                data += `<div class="col">`;
                data += `</div>`;
                data += `</div>`;
            })
            .catch(error => {
                console.log(error);
            });
            
            mainContent.innerHTML = data;
        }

        function showInvoice() {

            updateNavBar("nav-invoice");

            const mainContent = document.querySelector('.center-content');

            var data = "";

            axios.get("https://invoice-system-api.onrender.com/invoice/get/",
            {headers: { authorization: `Bearer ${token}` }})
                .then(response => {
                    
                    

                })
                .catch(error => {
                    console.log(error);
            });
            
            mainContent.innerHTML = data;
        }

        function addRow() {
            var table = document.getElementById("itemTable");
            var newRow = table.insertRow(table.rows.length - 1);

            var cells = [];
            for (var i = 0; i < 3; i++) {
                var cell = newRow.insertCell(i);
                var input = document.createElement("input");
                input.className = "form-control";
                input.type = (i === 1 || i === 2) ? "number" : "text";
                input.name = i === 0 ? "item[]" : i === 1 ? "quantity[]" : "unitPrice[]";
                cell.appendChild(input);
                cells.push(cell);
            }

            var actionCell = newRow.insertCell(3);
            var removeButton = document.createElement("button");
            removeButton.type = "button";
            removeButton.innerHTML = "Remove";
            removeButton.onclick = function () {
                table.deleteRow(newRow.rowIndex);
            };
            actionCell.appendChild(removeButton);
        }

        // Example: Call showTable when the page loads
        window.onload = function () {

            const urlParams = new URLSearchParams(window.location.search);
            updateNavBar(urlParams.get('content'));
              
        }
    </script>
</body>
</html>
